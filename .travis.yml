language: node_js
node_js:
- stable
cache:
  directories:
  - node_modules
before_script:
- echo $TRAVIS_TAG
- echo $(git describe --abbrev=0 --tags)
- bash scripts/deploy.sh $TRAVIS_BRANCH
script:
- npm test
- npm run build
deploy:
- provider: s3
  access_key_id: "$AWS_ACCESS_KEY_ID"
  secret_access_key: "$AWS_SECRET_ACCESS_KEY"
  bucket: "$AWS_BUCKET_NAME"
  local-dir: build
  skip_cleanup: true
  on:
    repo: ahdeshmukh/react-shopping-cart
    branch: master
after_deploy:
- aws configure set preview.cloudfront true
- test $TRAVIS_BRANCH = "master" && aws cloudfront create-invalidation --distribution-id
  $AWS_CLOUDFRONT_DISTRIBUTION_ID --paths "/*"
env:
  global:
    secure: F/du094X9KoOZ1zweMGdFmDVdvUofuL5ToDyQWmjjhLwHsoVBxgpFoBP9QEAU8ZBxU664XOQ0hnREnxo2L+jdilkpExOyCVmVSuZ2iaoAU7Oqz19YOdacLGvnmtSYzFmW/kbFrwXeaGOGUM8mqNB92qDjXvdL5TJx8r7LshG3sWaqZ2kngXANZhWGRjyf8mJumCfoZUVMto2RbszRlsS+HjiCKj3+B9POH0paL6TmNKWEj7PBSmWU6KuI/kCxlme/v63POzJV9w89aIQ2t825T+be314HbmiYbKnS5NDxWqBINok4Xr09VO6njBn6DgS089g2XQ+Yo2R4JwokvqfcaN8erJLqij9mE2OGEfmmXRyJ1K8vU3vqdgVcVUGXlPAlYD7Pwidyn9fiBX8IOcXE7C8Sre/80EmdYdS2PWGjryP3AiPN+UQ7FHSAPnUUsNOpwhbYcRESYvydAzbClvfYu46MbOsTPSL3nHvw8WLgQhy/eL6tYwhOTmbB++HERPbEuMZAB4YHKV4qN32x8+PFcnuRuJ2K+xR7HXCUtcXFUNRU053keb2g+VfeGteBZjM1D9Ff8xT7kC+JdjZl3SvYm7YgKp0gvQYIS5he/sQnpnYNCJKf+/5xKw9twAFQG9wVqb2EPTEpbwWlduBcopDdffAjwbIXQ3Z52Qjo6zklA8=
